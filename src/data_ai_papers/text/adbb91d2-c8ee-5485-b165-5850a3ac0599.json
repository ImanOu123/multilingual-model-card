{"title": "Neural Machine Translation with Monolingual Translation Memory *", "authors": "Deng Cai; Yan Wang; Huayang Li; Wai Lam; Lemao Liu", "pub_date": "", "abstract": "Prior work has proved that Translation memory (TM) can boost the performance of Neural Machine Translation (NMT). In contrast to existing work that uses bilingual corpus as TM and employs source-side similarity search for memory retrieval, we propose a new framework that uses monolingual memory and performs learnable memory retrieval in a crosslingual manner. Our framework has unique advantages. First, the cross-lingual memory retriever allows abundant monolingual data to be TM. Second, the memory retriever and NMT model can be jointly optimized for the ultimate translation goal. Experiments show that the proposed method obtains substantial improvements. Remarkably, it even outperforms strong TM-augmented NMT baselines using bilingual TM. Owning to the ability to leverage monolingual data, our model also demonstrates effectiveness in low-resource and domain adaptation scenarios.", "sections": [{"heading": "Introduction", "text": "Augmenting parametric neural network models with non-parametric memory (Khandelwal et al., 2019;Guu et al., 2020;Lewis et al., 2020a,b) has recently emerged as a promising direction to relieve the demand for ever-larger model size (Devlin et al., 2019;Radford et al., 2019;Brown et al., 2020). For the task of Machine Translation (MT), inspired by the Computer-Aided Translation (CAT) tools by professional human translators for increasing productivity for decades (Yamada, 2011), the usefulness of Translation Memory (TM) has long been recognized . In general, TM is a database that stores pairs of source text and its corresponding translations. Like for human translation, early work (Koehn and Senellart, 2010;He et al., 2010;Utiyama et al., 2011;Wang et al., 2013, inter alia) presents translations for similar source input to statistical translation models as additional cues.\nRecent work has confirmed that TM can help Neural Machine Translation (NMT) models as well. In a similar spirit to prior work, TM-augmented NMT models do not discard the training corpus after training but keep exploiting it in the test time. These models perform translation in two stages: In the retrieval stage, a retriever searches for nearest neighbors (i.e., source-target pairs) from the training corpus based on source-side similarity such as lexical overlaps (Gu et al., 2018;Zhang et al., 2018;Xia et al., 2019), embedding-based matches (Cao and Xiong, 2018), or a hybrid (Bulte and Tezcan, 2019;Xu et al., 2020); In the generation stage, the retrieved translations are injected into a standard NMT model by attending over them with sophisticated memory networks (Gu et al., 2018;Cao and Xiong, 2018;Xia et al., 2019;He et al., 2021) or directly concatenating them to the source input (Bulte and Tezcan, 2019;Xu et al., 2020), or biasing the word distribution during decoding (Zhang et al., 2018). Most recently, Khandelwal et al. (2020) propose a token-level nearest neighbor search using complete translation context, i.e., both the source-side input and target-side prefix.\nDespite their differences, we identify two major limitations in previous research. First, the translation memory has to be a bilingual corpus consisting of aligned source-target pairs. This requirement limits the memory bank to bilingual pairs and precludes the use of abundant monolingual data, which can be especially helpful for low-resource scenarios. Second, the memory retriever is non-learnable, not end-to-end optimized, and lacks for the ability to adapt to specific downstream NMT models. Concretely, current retrieval mechanisms (e.g., BM25) are generic similarity search, adopting a simple heuristic. That is, the more a source sentence overlaps with the input sentence, the more likely its target-side translation pieces will appear in the correct translation. Although this observation is true, the most similar one does not necessarily serve the best for NMT models. Ideally, the retrieval metric would be learned from the data in a task-dependent way: we wish to consider a memory only if it can indeed boost the quality of final translation.\nIn this work, we propose to augment NMT models with monolingual TM and a learnable crosslingual memory retriever. Specifically, we align source-side sentences and the corresponding targetside translations in a latent vector space using a simple dual-encoder framework (Bromley et al., 1993), such that the distance in the latent space yields a score function for retrieval. As a result, our memory retriever directly connects the dots between the source-side input and target-side translations, enabling monolingual data in the target language to be used alone as TM. Before running each translation, the memory retriever selects the highest-scored memories from a large collection of monolingual sentences (TM), which may include but are not limited to the target side of training corpus, and then the downstream NMT model attends over those memories to help inform its translation. We design the memory retriever with differentiable neural networks. To unify the memory retriever and its downstream NMT model into a learnable whole, the retrieval scores are used to bias the attention scores to the most useful retrieved memories. In this way, our memory retrieval can be end-to-end optimized for the translation objective: a retrieval that improves the golden translation's likelihood is helpful and should be rewarded, while an uninformative retrieval should be penalized.\nOne challenge for training our proposed framework is that, when starting from random initialization, the retrieved memories will likely be totally unrelated to the input. Since the memory retriever does not exert positive influence on NMT model's performance, it cannot receive a meaningful gradient and improve. This causes the NMT model to learn to ignore all retrieved memories. To avoid this cold-start problem, we propose to warm-start the retrieval model using two cross-alignment tasks.\nExperiments show that (1) Our model leads to significant improvements over non-TM baseline NMT model, even outperforming strong TM-augmented baselines. This is remarkable given that previous TM-augmented models rely on bilingual TM while our model only exploits the target side.\n(2) Our model can substantially boost translation quality in low-resource scenarios by utilizing extra monolingual TM that is not present in training pairs.\n(3) Our model gains a strong cross-domain transferability by hot-swapping domain-specific monolingual memory.", "publication_ref": ["b31", "b19", "b11", "b42", "b54", "b35", "b24", "b47", "b16", "b55", "b52", "b8", "b4", "b53", "b16", "b8", "b52", "b23", "b4", "b53", "b55", "b30", "b2"], "figure_ref": [], "table_ref": []}, {"heading": "Related Work", "text": "TM-augmented NMT This work contributes primarily to the research line of Translation Memory (TM) augmented Neural Machine Translation (NMT). Feng et al. (2017) augmented NMT with a bilingual dictionary to tackle infrequent word translation. Gu et al. (2018) proposed a model that retrieves examples similar to the test source sentence and encodes retrieved source-target pairs with keyvalue memory networks. Cao and Xiong (2018); Cao et al. (2019) used a gating mechanism to balance the impact of the translation memory. Zhang et al. (2018) proposed guiding models by retrieving n-grams and up-weighting the probabilities of retrieved n-grams. Bulte and Tezcan (2019) and Xu et al. (2020) used fuzzy-matching with translation memories and augment source sequences with retrieved source-target pairs. Xia et al. (2019) directly ignored the source side of a TM and packed the target side into a compact graph. Khandelwal et al. (2020) ran existing translation model on large bi-text corpora and recorded all hidden states for later nearest neighbor search at each decoding step, which is very compute-intensive. The distinctions between our work and prior work are obvious: (1) The TM in our framework is a collection of monolingual sentences rather than bilingual sentence pairs; (2) We use learnable task-specific retrieval rather than generic retrieval mechanisms.\nRetrieval for Text Generation Discrete retrieval as an intermediate step has been shown beneficial to a variety of natural language processing tasks. One typical use is to retrieve supporting evidence for open-domain question answering (e.g., Chen et al., 2017;Karpukhin et al., 2020). Recently, retrieval-guided generation has gained increasing interest in a wide range of text generation tasks such as language modeling Khandelwal et al., 2019;Guu et al., 2020), dialogue response generation (Weston et al., 2018;   2019a,b), code generation  and other knowledge-intensive generation (Lewis et al., 2020b). It can be observed that there is a shift from using off-the-shelf search engines to learning task-specific retrievers. Our work draws inspiration from this line of research. However, retrieval-guided generation has so far been mainly investigated for knowledge retrieval in the same language. The memory retrieval in this work is more challenging due to the cross-lingual setting.\nNMT using Monolingual Data To our knowledge, the integration of monolingual data for NMT was first investigated by Gulcehre et al. (2015), who separately trained target-side language models using monolingual data, and then integrated them during decoding either through re-scoring the beam, or by feeding the hidden state of the language model to the NMT model. Jean et al. (2015) also explored re-ranking the NMT output with a n-gram language model. Another successful method for leveraging monolingual data in NMT is back-translation (Sennrich et al., 2016;Fadaee et al., 2017;Edunov et al., 2018;He et al., 2016), where a reverse translation model is used to translate monolingual sentences from the target language to the source language to generate synthetic parallel sentences. Recent studies (Jiao et al., 2021;He et al., 2019) showed that self-training, where the synthetic parallel sentences are created by translating monolingual sentences in the source language, is also helpful. Our method is orthogonal to previous work and bears a unique feature: it can use more monolingual data without re-training (see \u00a74.3).", "publication_ref": ["b14", "b16", "b8", "b7", "b55", "b4", "b53", "b52", "b30", "b9", "b29", "b31", "b19", "b50", "b17", "b26", "b44", "b13", "b12", "b21", "b27", "b22"], "figure_ref": [], "table_ref": []}, {"heading": "Proposed Approach", "text": "We start by formalizing the translation task as a retrieve-then-generate process in \u00a73.1. Then in \u00a73.2, we describe the model design for the cross-lingual memory retrieval model. In \u00a73.3, we describe the model design for the memory-augmented translation model. Lastly, we show how to optimize the two components jointly using standard maximum likelihood training in \u00a73.4 and therein we address the cold-start problem via cross-alignment pre-training.", "publication_ref": [], "figure_ref": [], "table_ref": []}, {"heading": "Overview", "text": "Our approach decomposes the whole translation processing into two steps: retrieve, then generate. The overall framework is illustrated in Figure 1. The Translation Memory (TM) in our approach is a collection of sentences in the target language Z. Given an input x in the source language, the retrieval model first selects a number of possibly helpful sentences {z i } M i=1 from Z, where M |Z|, according to a relevance function f (x, z i ). Then, the translation model conditions on both the retrieved set {(z i , f (x, z i )} M i=1 and the original input x to generate the output y using a probabilistic model\np(y|x, z 1 , f (x, z 1 ), . . . , z M , f (x, z M )). Note that the relevance scores {f (x, z i )} M\ni=1 are also part of the input to the translation model, encouraging the translation model to focus more on more relevant sentences. During training, maximizing the likelihood of the translation references improves both the translation model and the retrieval model.", "publication_ref": [], "figure_ref": ["fig_0"], "table_ref": []}, {"heading": "Retrieval Model", "text": "The retrieval model is responsible for selecting the most relevant sentences for a source sentence from a large monolingual TM. This could involve measuring the relevance scores between the source sentence and millions of candidate target sentences, which poses a serious computational challenge. To address this, we implement the retrieval model using a simple dual-encoder framework (Bromley et al., 1993) such that the selection of the most relevant sentences can be reduced to Maximum Inner Product Search (MIPS). With performant data structures and search algorithms (e.g., Shrivastava and Li, 2014;Malkov and Yashunin, 2018), the retrieval can be done efficiently.\nSpecifically, we define the relevance score f (x, z) between the source sentence x and the candidate sentence z as the dot product of their dense vector representations:\nf (x, z) = E src (x) T E tgt (z)\nwhere E src and E tgt are the source sentence encoder and the target sentence encoder that map x and z to d-dimensional vectors respectively. We implement the two sentence encoders using two independent Transformers (Vaswani et al., 2017). For an input sentence, we prepend the [BOS] token to its token sequence and then feed it into a Transformer. We take the representation at the [BOS] token as the output (denoted Trans {src,tgt} ({x, z})), and perform a linear projection (W {src,tgt} ) to reduce the dimensionality of the vector. Finally, we normalize the vectors to regulate the range of relevance scores.\nE src (x) = normalize(W src Trans src (x)) E tgt (z) = normalize(W tgt Trans tgt (z))\nThe normalized vectors have zero means and unit lengths. Therefore, the relevance scores always fall in the interval [\u22121, 1]. We let \u03b8 denote all parameters associated with the retrieval model.\nIn practice, the dense representations of all sentences in TM can be pre-computed and indexed using FAISS (Johnson et al., 2019), an open-source toolkit for efficient vector search. Given a source sentence x in hand, we compute the vector representation v x = E src (x) and retrieve the top M target sentences with vectors closest to v x .", "publication_ref": ["b2", "b45", "b39", "b48", "b28"], "figure_ref": [], "table_ref": []}, {"heading": "Translation Model", "text": "Given a source sentence x, a small set of relevant TM {z i } M i=1 , and relevance scores {f (x, z i )} M i=1 , the translation model defines the conditional proba-\nbility p(y|x, z 1 , f (x, z 1 ), . . . , z M , f (x, z M )).\nOur translation model is built upon the standard encoder-decoder NMT model (Bahdanau et al., 2015;Vaswani et al., 2017): the (source) encoder transforms the source sentence x into dense vector representations. The decoder generates an output sequence y in an auto-regressive fashion. At each time step t, the decoder attends over both previously generated sequence y 1:t\u22121 and the output of the source encoder, generating a hidden state h t . The hidden state h t is then converted to next-token probabilities through a linear projection followed by softmax function, i.e.,\nP v = softmax(W v h t + b v ).\nTo accommodate the extra memory input, we extend the standard encoder-decoder NMT framework with a memory encoder and allow crossattention from the decoder to the memory encoder. Specifically, the memory encoder encodes each TM sentence z i individually, resulting in a set of contextualized token embeddings {z i,k } L i k=1 , where L i is the length of the token sequence z i . We compute a cross attention over all TM sentences:\n\u03b1 ij = exp(h t T W m z i,j )) M i=1 L i k=1 exp(h t T W m z i,k ) (1) c t = W c M i=1 L i j=1 \u03b1 ij z i,j\nwhere \u03b1 ij is the attention score of the j-th token in z i , c t is a weighted combination of memory embeddings, and W m and W c are trainable matrices. The cross attention is used twice during decoding. First, the decoder's hidden state h t is updated by a weighted sum of memory embeddings, i.e., h t = h t + c t . Second, we consider each attention score as a probability of copying the corresponding token (Gu et al., 2016;See et al., 2017). Formally, the next-token probabilities are computed as:\np(y t |\u2022) = (1 \u2212 \u03bb t )P v (y t ) + \u03bb t M i=1 L i j=1 \u03b1 ij 1 z ij =yt\nwhere 1 is the indicator function and \u03bb t is a gating variable computed by another feed-forward network \u03bb t = g(h t , c t ).\nInspired by Lewis et al. (2020a), to enable the gradient flow from the translation output to the retrieval model, we bias the attention scores with the relevance scores, rewriting Eq. (1) as:\n\u03b1 ij = exp(h t T W m z i,j + \u03b2f (x, z i )) M i=1 L i k=1 exp(h t T W m z i,k + \u03b2f (x, z i ))(2\n) where \u03b2 is a trainable scalar that controls the weight of the relevance scores. We let \u03c6 denote all parameters associated with the translation model.", "publication_ref": ["b1", "b48", "b15", "b43", "b37"], "figure_ref": [], "table_ref": []}, {"heading": "Training", "text": "We optimize the model parameters \u03b8 and \u03c6 using stochastic gradient descent on the negative log-likelihood loss function \u2212 log p(y * |x, z 1 , f (x, z 1 ), . . . , z M , f (x, z M )), where y * refers to the reference translation. As implied by Eq. (2), TM sentences that improve the likelihood of reference translations should receive higher attention scores and higher relevance scores, so gradient descent on the loss function will improve the quality of the retrieval model as well.\nCross-alignment Pre-training However, if the retrieval model starts from random initialization, all top TM sentences z i will likely be unrelated to x (or equally useless). This leads to a problem that the retrieval model cannot receive meaningful gradients and improve, and the translation model will learn to completely ignore the TM input. To avoid this cold-start problem, we propose two crossalignment tasks to warm-start the retrieval model.\nThe first task is sentence-level cross-alignment. This task aims to find the right translation for a source sentence given a set of other translations, which is directly related to our retrieval function. Concretely, We sample B source-target pairs from the training corpus at each training step. Let X and Z be the (B \u00d7 d) matrix of the source and target vectors encoded by E src and E tgt respectively. S = XZ T is a (B \u00d7 B) matrix of relevance scores, where each row corresponds to a source sentence and each column corresponds to a target sentence. Any (X i , Z j ) pair should be aligned when i = j, and should not otherwise. The objective is to maximize the scores along the diagonal of the matrix and henceforth reduce the values in other entries. The loss function can be written as:\nL (i) snt = \u2212 exp(S ii ) exp(S ii ) + j =i exp(S ij )\n.\nThe second task is token-level cross-alignment, which aims to predict the tokens in the target language given the source sentence representation and vice versa. Formally, we use bag-of-words losses:\nL (i) tok = \u2212 wy\u2208Y i log p(w y |X i ) + wx\u2208X i log p(w x |Y i )\nwhere X i (Y i ) represents the set of tokens in the i-th source (target) sentence and the token probabilities are computed by a linear projection followed by the softmax function. The joint loss for pre-training is 1\nB B i=1 L (i) snt + L (i)\ntok . In practice, we find that both the sentence-level and token-level objectives are crucial for achieving superior performance.  Asynchronous Index Refresh To employ fast MIPS, we must pre-compute E tgt (z) for every z \u2208 Z and build an index. However, the index cannot remain consistent with the running model during training as \u03b8 will be updated over time. One straightforward solution to fix the parameters of E tgt after the pre-training described above and only fine-tune the parameters of E src . However, this may hurt performance since E tgt cannot adapt to the translation objective. Another solution is to asynchronously refresh the index by re-computing and re-indexing all TM sentences at regular intervals.\nThe index is slightly outdated between refreshes, however, we use fresh E tgt in gradient estimate. We explore both options in our experiments.", "publication_ref": [], "figure_ref": [], "table_ref": []}, {"heading": "Experiments", "text": "We experiment with the proposed approach in three settings: (1) the conventional setting where the available TM is limited to the bilingual training corpus, (2) the low-resource setting where bilingual training pairs are scarce but extra monolingual data is exploited as additional TM, and (3) nonparametric domain adaptation using monolingual TM. Note that existing TM-augmented NMT models are only applicable to the first setting, the last two settings only become possible with our proposed model. We use BLEU score (Papineni et al., 2002) as the evaluation metric.", "publication_ref": ["b41"], "figure_ref": [], "table_ref": []}, {"heading": "Implementation Details", "text": "We build our model using Transformer blocks with the same configuration as Transformer Base (Vaswani et al., 2017) (8 attention heads, 512 dimensional hidden state, and 2048 dimensional feed-forward state). The number of Transformer blocks is 3 for the retrieval model, 4 for the memory encoder in the translation model, and 6 for the encoder-decoder architecture in the translation model. We retrieve the top 5 TM sentences. The FAISS index code is \"IVF1024 HNSW32,SQ8\" and the search depth is 64. We follow the learning rate schedule, dropout and label smoothing settings described in Vaswani et al. (2017). We use Adam optimizer (Kingma and Ba, 2014) and train models with up to 100K   Xia et al. (2019). \u2020The two variants of our method (model #4 and model #5) are significantly better than other baselines with p-value < 0.01, tested by bootstrap re-sampling (Koehn, 2004).\nsteps throughout all experiments. When trained with asynchronous index refresh, the re-indexing interval is 3K training steps. 1", "publication_ref": ["b48", "b48", "b32", "b52", "b33"], "figure_ref": [], "table_ref": []}, {"heading": "Conventional Experiments", "text": "Following prior work in TM-augmented NMT, we first conduct experiments in a setting where the bilingual training corpus is the only source for TM.\nData We use the JRC-Acquis corpus (Steinberger et al., 2006) for our experiments. The JRC-Acquis corpus contains the total body of European Union (EU) law applicable to the EU member states. This corpus was also used by Gu et al. (2018); Zhang et al. (2018); Xia et al. (2019) and we managed to get the datasets originally preprocessed by Gu et al. (2018), making it possible to fairly compare our results with previously reported BLEU scores. Specifically, we select four translation directions, namely, Spanish\u21d2English (Es\u21d2En), En\u21d2Es, German\u21d2English (De\u21d2En), and En\u21d2De, for evaluation. Detailed data statistics are shown in Table 1.\nModels To study the effect of each model component, we implement a series of model variants (model #1 to #5 in Table 2).\n1. NMT without TM. To measure the help from TM, we remove the model components related to TM (including the retrieval model and the memory encoder), and only employ the encoder-decoder architecture for NMT. The resulted model is equivalent to the Transformer Base model (Vaswani et al., 2017).\n2. TM-augmented NMT using source similarity search. To isolate the effect of architectural changes in NMT models, we replace our cross-lingual memory retriever with traditional source-side similarity search. Specifically, we use the fuzzy match system used in Xia et al. (2019) and many others, which is based on BM25 and edit distance.\n3. TM-augmented NMT using pre-trained crosslingual retriever. To study the effect of end-toend task-specific optimization of the retrieval model, we pre-train the retrieval model using the cross-alignment tasks introduced in \u00a73.4 and keep it fixed in the following NMT training.\n4. Our full model using a fixed TM index; After pre-training, we fix the parameter of E tgt during NMT training.\n5. Our full model trained with asynchronous index refresh.", "publication_ref": ["b46", "b16", "b55", "b52", "b16", "b48", "b52"], "figure_ref": [], "table_ref": ["tab_2", "tab_4"]}, {"heading": "Results", "text": "The results of the above models are presented in Table 2. We have the following observations: (1) Our full model trained with asynchronous index refresh (model #5) delivers the best performance on test sets across all four translation tasks, outperforming the non-TM baseline (model #1) by 3.26 BLEU points in average and up to 3.86 BLEU points (De\u21d2En). This result confirms that monolingual TM can boost NMT performance;\n(2) The end-to-end learning of the retriever model is the key for substantial performance improvement. We can see that using a pre-trained fixed crosslingual retriever only gives moderate test performance, fine-tuning E src and fixing E tgt significantly boosts the performance, and fine-tuning both E src and E tgt leads to the strongest performance (model #5>model #4>model #3); (3) Cross-lingual retrieval (model #4 and model #5) can obtain better results than that of the source similarity search (model #2). This is remarkable since the crosslingual retrieval only requires monolingual TM, while the source similarity search relies on bilingual TM. We attribute the success, again, to the endto-end adaptability of our cross-lingual retriever. This is manifested by the fact that model #3 even slightly underperforms model #2 in some of translation tasks.", "publication_ref": [], "figure_ref": [], "table_ref": ["tab_4"]}, {"heading": "Contrast to Previous Bilingual TM Systems", "text": "We also compare our results with the best previously reported models. 2 We can see that our results significantly outperform previous arts. Notably, our best model (model #5) surpasses the best reported model (Xia et al., 2019) by 1.69 BLEU points in average and up to 2.9 BLEU points (De\u21d2En). This result verifies the effectiveness of our proposed models. In fact, we can see that our translation model using traditional similarity search (model #2) already outperforms the best previously reported results, which reveals that the architectural design of our translation model is surprisingly effective despite its simplicity.", "publication_ref": ["b52"], "figure_ref": [], "table_ref": []}, {"heading": "Low-Resource Scenarios", "text": "One most unique characteristic of our proposed model is that it uses monolingual TM. This motivates us to conduct experiments in low-resource scenarios, where we use extra monolingual data in the target language to boost translation quality.   base) and a bilingual TM baseline (model #2).\nResults Figure 2 shows the main results on the test sets. The general patterns are consistent across all experiments: the larger the TM becomes, the better translation performance the model achieves.\nWhen using all available monolingual data (4/4), the translation quality is boosted significantly. Interestingly, the performance of models without retraining is comparable to, if not better than, those with re-training. We also observe that when the training pairs are very scarce (only 1/4 bilingual pairs are available), a small size of TM even hurts the model performance. The reason could be overfitting. We speculate that better results would be obtained by tuning the model hyper-parameters according to different TM sizes.", "publication_ref": [], "figure_ref": ["fig_1"], "table_ref": []}, {"heading": "Contrast to Back-Translation", "text": "We compare our models with back-translation (BT) (Sennrich et al., 2016), a popular way of utilizing monolingual data for NMT. We train a target-to-source Transformer Base model using bilingual pairs and use the resultant model to translate monolingual sentences to obtain additional synthetic parallel data. As shown in Table 3, our method performs better than BT with 2/4 bilingual pairs but performs worse with 1/4 bilingual pairs. Interestingly, the combination of BT and our method yields significant further gains, which demonstrates that our method is not only orthogonal but also complementary to BT.", "publication_ref": ["b44"], "figure_ref": [], "table_ref": ["tab_6"]}, {"heading": "Non-parametric Domain Adaptation", "text": "Lastly, the \"plug and play\" property of TM further motivates us to domain adaptation, where we adapt a single general-domain model to a specific domain by using domain-specific monolingual TM.  Lewis, 2010;Chu and Wang, 2018) as future work.", "publication_ref": ["b40", "b10"], "figure_ref": [], "table_ref": []}, {"heading": "Results", "text": "The results are presented in Table 4. We can see that when only using the bilingual data, the TM-augmented model obtains higher BLEU scores in domains with less data but slightly lower scores in other domains compared to the non-TM baseline. However, as we switch the TM to domain-specific TM, the translation quality is significantly boosted in all domains, improving the non-TM baseline by an average of 1.85 BLEU points, with improvements as large as 2.57 BLEU points on Law and 2.51 BLEU point on Medical. We also attempt to combine all domain-specific TMs to one and use it for all domains (the last row in Table 4). However, we do not obtain noticeable improvement. This reveals that the out-of-domain data can provide little help so that a smaller in-domain TM is sufficient, which is also confirmed by the fact that about 90.21% of the retrieved sentences come from the corresponding domain in the combined TM.", "publication_ref": [], "figure_ref": [], "table_ref": ["tab_7", "tab_7"]}, {"heading": "Running Speed", "text": "With the help of FAISS in-GPU index, search over millions of vectors can be made incredibly efficient (often in tens of milliseconds). In our implementation, the memory search performs even faster than naive BM25 3 . For the results in  5 presents the results. In addition, we also observe that memory-augmented models converge much faster than vanilla models in terms of training steps.", "publication_ref": [], "figure_ref": [], "table_ref": ["tab_11"]}, {"heading": "Conclusion", "text": "We introduced an effective approach that augments NMT models with monolingual TM. We show that a task-specific cross-lingual memory retriever can be learned by end-to-end MT training. Our approach achieves new state-of-the-art results on sev-  Future work should aim to build over our proposed framework. Two obvious directions are: (1) Even though our experiments validated that the whole framework can be learned from scratch using standard MT corpora, it is possible to initialize each model component in our framework with massively pre-trained models for performance enhancement; and (2) The NMT model can benefit from aggregating over a set of diverse memories, which is not explicitly encouraged in current design.", "publication_ref": [], "figure_ref": [], "table_ref": []}], "references": [{"ref_id": "b0", "title": "Unsupervised domain clusters in pretrained language models", "journal": "", "year": "2020", "authors": "Roee Aharoni; Yoav Goldberg"}, {"ref_id": "b1", "title": "Neural machine translation by jointly learning to align and translate", "journal": "", "year": "2015", "authors": "Dzmitry Bahdanau; Kyunghyun Cho; Yoshua Bengio"}, {"ref_id": "b2", "title": "Signature verification using a\" siamese\" time delay neural network", "journal": "", "year": "1993", "authors": "Jane Bromley; Isabelle Guyon; Yann Lecun; Eduard S\u00e4ckinger; Roopak Shah"}, {"ref_id": "b3", "title": "", "journal": "", "year": "2005", "authors": "T Brown; B Mann; Nick Ryder; Melanie Subbiah; J Kaplan; P Dhariwal; Arvind Neelakantan; Pranav Shyam; Girish Sastry; Amanda Askell; Sandhini Agarwal; Ariel Herbert-Voss; G Kr\u00fcger; Tom Henighan; R Child; Aditya Ramesh; D Ziegler; Jeffrey Wu; Clemens Winter; Christopher Hesse; Mark Chen; E Sigler; Mateusz Litwin; Scott Gray; J Benjamin Chess; Christopher Clark; Sam Berner; A Mc-Candlish; Ilya Radford;  Sutskever"}, {"ref_id": "b4", "title": "Neural fuzzy repair: Integrating fuzzy matches into neural machine translation", "journal": "", "year": "2019", "authors": "Bram Bulte; Arda Tezcan"}, {"ref_id": "b5", "title": "Skeleton-to-response: Dialogue generation guided by retrieval memory", "journal": "", "year": "2019", "authors": "Deng Cai; Yan Wang; Wei Bi; Zhaopeng Tu; Xiaojiang Liu; Wai Lam; Shuming Shi"}, {"ref_id": "b6", "title": "Retrievalguided dialogue response generation via a matchingto-generation framework", "journal": "", "year": "2019", "authors": "Deng Cai; Yan Wang; Wei Bi; Zhaopeng Tu; Xiaojiang Liu; Shuming Shi"}, {"ref_id": "b7", "title": "Learning to reuse translations: Guiding neural machine translation with examples", "journal": "", "year": "2019", "authors": "Qian Cao; Shaohui Kuang; Deyi Xiong"}, {"ref_id": "b8", "title": "Encoding gated translation memory into neural machine translation", "journal": "", "year": "2018", "authors": "Qian Cao; Deyi Xiong"}, {"ref_id": "b9", "title": "Reading Wikipedia to answer opendomain questions", "journal": "Long Papers", "year": "2017", "authors": "Danqi Chen; Adam Fisch; Jason Weston; Antoine Bordes"}, {"ref_id": "b10", "title": "A survey of domain adaptation for neural machine translation", "journal": "", "year": "2018", "authors": "Chenhui Chu; Rui Wang"}, {"ref_id": "b11", "title": "BERT: Pre-training of deep bidirectional transformers for language understanding", "journal": "", "year": "2019", "authors": "Jacob Devlin; Ming-Wei Chang; Kenton Lee; Kristina Toutanova"}, {"ref_id": "b12", "title": "Understanding back-translation at scale", "journal": "", "year": "2018", "authors": "Sergey Edunov; Myle Ott; Michael Auli; David Grangier"}, {"ref_id": "b13", "title": "Data augmentation for low-resource neural machine translation", "journal": "Short Papers", "year": "2017", "authors": "Marzieh Fadaee; Arianna Bisazza; Christof Monz"}, {"ref_id": "b14", "title": "Memory-augmented neural machine translation", "journal": "", "year": "2017", "authors": "Yang Feng; Shiyue Zhang; Andi Zhang; Dong Wang; Andrew Abel"}, {"ref_id": "b15", "title": "Incorporating copying mechanism in sequence-to-sequence learning", "journal": "Long Papers", "year": "2016", "authors": "Jiatao Gu; Zhengdong Lu; Hang Li; O K Victor;  Li"}, {"ref_id": "b16", "title": "Search engine guided neural machine translation", "journal": "", "year": "2018", "authors": "Jiatao Gu; Yong Wang; Kyunghyun Cho; O K Victor;  Li"}, {"ref_id": "b17", "title": "On using monolingual corpora in neural machine translation", "journal": "", "year": "2015", "authors": "Caglar Gulcehre; Orhan Firat; Kelvin Xu; Kyunghyun Cho; Loic Barrault; Huei-Chi Lin; Fethi Bougares; Holger Schwenk; Yoshua Bengio"}, {"ref_id": "b18", "title": "Generating sentences by editing prototypes", "journal": "Transactions of the Association for Computational Linguistics", "year": "2018", "authors": "Kelvin Guu; B Tatsunori; Yonatan Hashimoto; Percy Oren;  Liang"}, {"ref_id": "b19", "title": "Realm: Retrievalaugmented language model pre-training", "journal": "", "year": "2020", "authors": "Kelvin Guu; Kenton Lee; Zora Tung; Panupong Pasupat; Ming-Wei Chang"}, {"ref_id": "b20", "title": "A retrieve-and-edit framework for predicting structured outputs", "journal": "", "year": "2018", "authors": "B Tatsunori; Kelvin Hashimoto; Yonatan Guu; Percy S Oren;  Liang"}, {"ref_id": "b21", "title": "Dual learning for machine translation", "journal": "", "year": "2016", "authors": "Di He; Yingce Xia; Tao Qin; Liwei Wang; Nenghai Yu; Tie-Yan Liu; Wei-Ying Ma"}, {"ref_id": "b22", "title": "Revisiting self-training for neural sequence generation", "journal": "", "year": "2019", "authors": "Junxian He; Jiatao Gu; Jiajun Shen; Marc'aurelio Ranzato"}, {"ref_id": "b23", "title": "Fast and accurate neural machine translation with translation memory", "journal": "", "year": "2021", "authors": "Qiuxiang He; Guoping Huang; Qu Cui; Li Li; Lemao Liu"}, {"ref_id": "b24", "title": "Bridging smt and tm with translation recommendation", "journal": "", "year": "2010", "authors": "Yifan He; Yanjun Ma; Josef Van Genabith; Andy Way"}, {"ref_id": "b25", "title": "Transmart: a practical interactive machine translation system. arXiv preprint arXiv", "journal": "", "year": "2021", "authors": "Guoping Huang; Lemao Liu; Xing Wang; Longyue Wang; Huayang Li; Zhaopeng Tu; Chengyan Huang; Shuming Shi"}, {"ref_id": "b26", "title": "Montreal neural machine translation systems for wmt'15", "journal": "", "year": "2015", "authors": "S\u00e9bastien Jean; Orhan Firat; Kyunghyun Cho; Roland Memisevic; Yoshua Bengio"}, {"ref_id": "b27", "title": "Selftraining sampling with monolingual data uncertainty for neural machine translation", "journal": "", "year": "2021", "authors": "Wenxiang Jiao; Xing Wang; Zhaopeng Tu; Shuming Shi; R Michael Lyu; Irwin King"}, {"ref_id": "b28", "title": "Billion-scale similarity search with gpus", "journal": "IEEE Transactions on Big Data", "year": "2019", "authors": "Jeff Johnson; Matthijs Douze; Herv\u00e9 J\u00e9gou"}, {"ref_id": "b29", "title": "Dense passage retrieval for open-domain question answering", "journal": "", "year": "2020", "authors": "Vladimir Karpukhin; Barlas Oguz; Sewon Min; Patrick Lewis; Ledell Wu; Sergey Edunov; Danqi Chen; Wen-Tau Yih"}, {"ref_id": "b30", "title": "Nearest neighbor machine translation", "journal": "", "year": "2020", "authors": "Urvashi Khandelwal; Angela Fan; Dan Jurafsky; Luke Zettlemoyer; Mike Lewis"}, {"ref_id": "b31", "title": "Generalization through memorization: Nearest neighbor language models", "journal": "", "year": "2019", "authors": "Urvashi Khandelwal; Omer Levy; Dan Jurafsky; Luke Zettlemoyer; Mike Lewis"}, {"ref_id": "b32", "title": "Adam: A method for stochastic optimization", "journal": "", "year": "2014", "authors": "P Diederik; Jimmy Kingma;  Ba"}, {"ref_id": "b33", "title": "Statistical significance tests for machine translation evaluation", "journal": "", "year": "2004", "authors": "Philipp Koehn"}, {"ref_id": "b34", "title": "Six challenges for neural machine translation", "journal": "", "year": "2017", "authors": "Philipp Koehn; Rebecca Knowles"}, {"ref_id": "b35", "title": "Convergence of translation memory and statistical machine translation", "journal": "", "year": "2010", "authors": "Philipp Koehn; Jean Senellart"}, {"ref_id": "b36", "title": "Latent retrieval for weakly supervised open domain question answering", "journal": "", "year": "2019", "authors": "Kenton Lee; Ming-Wei Chang; Kristina Toutanova"}, {"ref_id": "b37", "title": "Pre-training via paraphrasing", "journal": "", "year": "2020", "authors": "Mike Lewis; Marjan Ghazvininejad; Gargi Ghosh; Armen Aghajanyan; Sida Wang; Luke Zettlemoyer"}, {"ref_id": "b38", "title": "Tim Rockt\u00e4schel, et al. 2020b. Retrieval-augmented generation for knowledge-intensive nlp tasks", "journal": "", "year": "", "authors": "Patrick Lewis; Ethan Perez; Aleksandara Piktus; Fabio Petroni; Vladimir Karpukhin; Naman Goyal; Heinrich K\u00fcttler; Mike Lewis; Wen-Tau Yih"}, {"ref_id": "b39", "title": "Efficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs", "journal": "", "year": "2018", "authors": "A Yury;  Malkov;  Dmitry A Yashunin"}, {"ref_id": "b40", "title": "Intelligent selection of language model training data", "journal": "", "year": "2010", "authors": "C Robert; William Moore;  Lewis"}, {"ref_id": "b41", "title": "Bleu: a method for automatic evaluation of machine translation", "journal": "", "year": "2002", "authors": "Kishore Papineni; Salim Roukos; Todd Ward; Wei-Jing Zhu"}, {"ref_id": "b42", "title": "Language models are unsupervised multitask learners", "journal": "OpenAI blog", "year": "2019", "authors": "Alec Radford; Jeffrey Wu; Rewon Child; David Luan; Dario Amodei; Ilya Sutskever"}, {"ref_id": "b43", "title": "Get to the point: Summarization with pointergenerator networks", "journal": "Long Papers", "year": "2017", "authors": "Abigail See; J Peter; Christopher D Liu;  Manning"}, {"ref_id": "b44", "title": "Improving neural machine translation models with monolingual data", "journal": "Long Papers", "year": "2016", "authors": "Rico Sennrich; Barry Haddow; Alexandra Birch"}, {"ref_id": "b45", "title": "Asymmetric lsh (alsh) for sublinear time maximum inner product search (mips)", "journal": "", "year": "2014", "authors": "Anshumali Shrivastava; Ping Li"}, {"ref_id": "b46", "title": "The jrc-acquis: A multilingual aligned parallel corpus with 20+ languages", "journal": "", "year": "2006", "authors": "Ralf Steinberger; Bruno Pouliquen; Anna Widiger; Camelia Ignat"}, {"ref_id": "b47", "title": "Searching translation memories for paraphrases", "journal": "", "year": "2011", "authors": "Masao Utiyama; Graham Neubig; Takashi Onishi; Eiichiro Sumita"}, {"ref_id": "b48", "title": "Attention is all you need", "journal": "", "year": "2017", "authors": "Ashish Vaswani; Noam Shazeer; Niki Parmar; Jakob Uszkoreit; Llion Jones; Aidan N Gomez; \u0141ukasz Kaiser; Illia Polosukhin"}, {"ref_id": "b49", "title": "Integrating translation memory into phrase-based machine translation during decoding", "journal": "", "year": "2013", "authors": "Kun Wang; Chengqing Zong; Keh-Yih Su"}, {"ref_id": "b50", "title": "Retrieve and refine: Improved sequence generation models for dialogue", "journal": "", "year": "2018", "authors": "Jason Weston; Emily Dinan; Alexander Miller"}, {"ref_id": "b51", "title": "Response generation by context-aware prototype editing", "journal": "", "year": "2019", "authors": "Yu Wu; Furu Wei; Shaohan Huang; Yunli Wang; Zhoujun Li; Ming Zhou"}, {"ref_id": "b52", "title": "Graph based translation memory for neural machine translation", "journal": "", "year": "2019", "authors": "Mengzhou Xia; Guoping Huang; Lemao Liu; Shuming Shi"}, {"ref_id": "b53", "title": "Boosting neural machine translation with similar translations", "journal": "", "year": "2020", "authors": "Jitao Xu; Josep Crego; Jean Senellart"}, {"ref_id": "b54", "title": "The effect of translation memory databases on productivity", "journal": "", "year": "2011", "authors": "Masaru Yamada"}, {"ref_id": "b55", "title": "Guiding neural machine translation with retrieved translation pieces", "journal": "Long Papers", "year": "2018", "authors": "Jingyi Zhang; Masao Utiyama; Eiichro Sumita; Graham Neubig; Satoshi Nakamura"}], "figures": [{"figure_label": "1", "figure_type": "figure", "figure_id": "fig_0", "figure_caption": "Figure 1 :1Figure 1: Overall framework. For an input sentence x in the source language, the retrieval model uses Maximum Inner Product Search (MIPS) to find the top-M TM sentences {z i } M i=1 in the target language. The translation model takes {z i } M i=1 and corresponding relevance scores {f (x, z i )} M i=1 as input and generate the translation y.", "figure_data": ""}, {"figure_label": "2", "figure_type": "figure", "figure_id": "fig_1", "figure_caption": "Figure 2 :2Figure 2: Test results with 1/4 bilingual pairs (upper) and 2/4 bilingual pairs (lower) across different TM sizes.", "figure_data": ""}, {"figure_label": "1", "figure_type": "table", "figure_id": "tab_2", "figure_caption": "Data statistics for the JRC-Acquis corpus.", "figure_data": ""}, {"figure_label": "", "figure_type": "table", "figure_id": "tab_3", "figure_caption": "Zhang et al. (2018) source similarity 63.97 64.30 61.50 61.56 60.10 60.26 55.54 55.14 Xia et al. (2019) source similarity 66.37 66.21 62.50 62.76 61.85 61.72 57.43 56.88", "figure_data": "# SystemRetrieverEs\u21d2En Dev TestEn\u21d2Es Dev TestDe\u21d2En Dev TestEn\u21d2De Dev TestExisting NMT systems*Gu et al. (2018)source similarity63.16 62.94 ------Our NMT systems1None64.25 64.07 62.27 61.54 59.82 60.76 55.01 54.902source similarity66.98 66.48 63.04 62.76 63.62 63.85 57.88 57.533this workcross-lingual (fixed)66.68 66.24 63.06 62.73 63.25 63.06 57.61 56.974cross-lingual (fixed Etgt) \u202067.66 67.16 63.73 63.22 64.39 64.01 58.12 57.925cross-lingual \u202067.73 67.42 64.18 63.86 64.48 64.62 58.77 58.42"}, {"figure_label": "2", "figure_type": "table", "figure_id": "tab_4", "figure_caption": "Experimental results (BLEU scores) on four translation tasks.", "figure_data": ""}, {"figure_label": "", "figure_type": "table", "figure_id": "tab_5", "figure_caption": "61.02 57.86 57.40 56.77 56.54 51.11 51.58 BT 62.47 61.99 60.28 59.59 57.75 58.20 52.47 52.96 Ours+BT 65.98 65.51 62.48 62.22 62.22 61.79 56.75 56.50 64.69 61.31 61.01 61.43 61.19 55.55 55.35 BT 63.82 63.10 61.59 60.83 59.17 59.26 54.18 54.29 Ours+BT 66.95 66.38 63.22 62.90 63.68 63.10 57.69 57.40", "figure_data": "DataModelEs\u21d2En dev testEn\u21d2Es dev testDe\u21d2En dev testEn\u21d2De dev test1/4 bilingual + 4/4 monolingual 61.46 2/4 bilingual + Ours Ours 65.174/4 monolingualData We create low-resource scenarios by ran-domly partitioning each training set in JRC-Acquiscorpus into four subsets of equal size. We set uptwo series of experiments: (1) We only use thebilinguals pairs in the first subset and gradually en-large the TM by including more monolingual datain other subsets. (2) Similar to (1), but we insteaduse the bilingual pairs in the first two subsets.Models As shown in  \u00a74.2, the model trained withasynchronous index refresh (model #5) is slightlybetter than the model using fixed E tgt (model #4),however, the computational cost of training model#5 is much bigger. For simplicity and environmen-tal consideration, we only test model #4 in low-resource scenarios. Nevertheless, we note thereare still two modeling choices: (1) train the modelonce with the TM limited to training pairs andonly enlarge the TM during testing; (2) re-train themodel with every enlarged TM. Note that whenusing the first choice, the model may retrieve aTM sentence that has never been seen during train-ing. To measure the performance improvementsfrom additional monolingual TM, we also includea Transformer Base baseline (model #1, denoted as"}, {"figure_label": "3", "figure_type": "table", "figure_id": "tab_6", "figure_caption": "Comparison with back-translation (BT).", "figure_data": "MedicalLawITKoran SubtitleAvg.Avg. \u2206#Bilingual Pairs61,388114,93055,0604,458124,992--#Monolingual Sents184,165 344,791 165,181 13,375 374,977--Using Bilingual Pairs OnlyTransformer Base47.8151.4033.9014.6421.6433.88-Ours47.5251.1734.6415.4922.6634.30+0.42+ Monolingual MemoryOurs + domain-specific50.3253.9735.3316.2622.7835.73+1.85Ours + all-domains50.2354.1235.2416.2422.7835.72+1.84"}, {"figure_label": "4", "figure_type": "table", "figure_id": "tab_7", "figure_caption": "Test results on domain adaptation.", "figure_data": ""}, {"figure_label": "", "figure_type": "table", "figure_id": "tab_8", "figure_caption": "Koran and Subtitles. Similar to the experiments in \u00a74.3, we only use one fourth of bilingual pairs for training. The target side of the remaining data is treated as additional monolingual data for building domain-specific TM, and the source side is discarded. The data statistics can be found in the upper block of Table4. The dev and test sets for each domain contains 2K instances.", "figure_data": "Data To simulate a diverse multi-domain setting,we use the data splits in Aharoni and Goldberg(2020) originally collected by Koehn and Knowles(2017). It includes German-English parallel datafor train/dev/test sets in five domains: Medical,Law, IT, Models We first train a Transformer Base base-line (model #1) on the concatenation of bilingualpairs in all domains. As in  \u00a74.3, we train our modelusing fixed E tgt (model #4). One advantage ofour approach is the possibility of training a singlemodel which can be adapted to any new domain atthe inference time without any re-training, by justswitching the TM. When adapting to a new TM,we do not re-train our model. As the purpose hereis to verify that our approach can tackle domainadaptation without any domain-specific training,we leave the comparison and combination of otherdomain adaptation techniques (Moore and"}, {"figure_label": "2", "figure_type": "table", "figure_id": "tab_9", "figure_caption": ", taking the vanilla Transformer Base model (model #1) as the baseline. The inference latency of our models (both model #4 and model #5) is about 1.36 times of the baseline (all use a single Nividia V100 GPU). Note that the corresponding number for the previous state-of-the-art model(Xia et al., 2019) is 1.80. As for training cost, the averaged time cost per training step of model #4 and model #5 is 2.62 times and 2.76 times of the baseline respectively, which are on par with traditional TM-augmented baselines (model #2 is 2.59 times) (all use two Nividia V100 GPUs). Table", "figure_data": ""}, {"figure_label": "5", "figure_type": "table", "figure_id": "tab_11", "figure_caption": "Latency cost for training and inference. For training, we measure the averaged time cost per training step. The number of Xia et al. (2019) is inferred from their paper. eral datasets, leads to large gains in low-resource scenarios where the bilingual data is limited, and can specialize a NMT model for specific domains without further training.", "figure_data": ""}], "formulas": [{"formula_id": "formula_0", "formula_text": "p(y|x, z 1 , f (x, z 1 ), . . . , z M , f (x, z M )). Note that the relevance scores {f (x, z i )} M", "formula_coordinates": [3.0, 307.28, 525.77, 218.27, 24.18]}, {"formula_id": "formula_1", "formula_text": "f (x, z) = E src (x) T E tgt (z)", "formula_coordinates": [4.0, 123.57, 195.25, 115.12, 13.05]}, {"formula_id": "formula_2", "formula_text": "E src (x) = normalize(W src Trans src (x)) E tgt (z) = normalize(W tgt Trans tgt (z))", "formula_coordinates": [4.0, 94.47, 405.64, 173.34, 27.35]}, {"formula_id": "formula_3", "formula_text": "bility p(y|x, z 1 , f (x, z 1 ), . . . , z M , f (x, z M )).", "formula_coordinates": [4.0, 72.0, 660.67, 197.14, 10.69]}, {"formula_id": "formula_4", "formula_text": "P v = softmax(W v h t + b v ).", "formula_coordinates": [4.0, 307.28, 120.51, 218.27, 24.18]}, {"formula_id": "formula_5", "formula_text": "\u03b1 ij = exp(h t T W m z i,j )) M i=1 L i k=1 exp(h t T W m z i,k ) (1) c t = W c M i=1 L i j=1 \u03b1 ij z i,j", "formula_coordinates": [4.0, 335.37, 271.43, 190.17, 68.83]}, {"formula_id": "formula_6", "formula_text": "p(y t |\u2022) = (1 \u2212 \u03bb t )P v (y t ) + \u03bb t M i=1 L i j=1 \u03b1 ij 1 z ij =yt", "formula_coordinates": [4.0, 308.29, 489.58, 215.24, 33.96]}, {"formula_id": "formula_7", "formula_text": "\u03b1 ij = exp(h t T W m z i,j + \u03b2f (x, z i )) M i=1 L i k=1 exp(h t T W m z i,k + \u03b2f (x, z i ))(2", "formula_coordinates": [4.0, 308.07, 631.38, 215.49, 40.58]}, {"formula_id": "formula_8", "formula_text": "L (i) snt = \u2212 exp(S ii ) exp(S ii ) + j =i exp(S ij )", "formula_coordinates": [5.0, 101.1, 529.04, 155.84, 27.09]}, {"formula_id": "formula_9", "formula_text": "L (i) tok = \u2212 wy\u2208Y i log p(w y |X i ) + wx\u2208X i log p(w x |Y i )", "formula_coordinates": [5.0, 72.0, 632.42, 228.59, 26.83]}, {"formula_id": "formula_10", "formula_text": "B B i=1 L (i) snt + L (i)", "formula_coordinates": [5.0, 83.37, 724.67, 90.06, 16.5]}], "doi": ""}